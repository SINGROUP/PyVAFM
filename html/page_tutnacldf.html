<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>3d FM-AFM tutorials</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<!--<link href="tabs.css" rel="stylesheet" type="text/css"> -->
<!-- <script src="../mathjax/MathJax.js">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script> -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22953817-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script type="text/javascript">
function toggleMenu(objID, button) {
    if (!document.getElementById) return;
    var ob = document.getElementById(objID).style;
    if(ob.display == 'block') {
	ob.display = 'none';
	button.innerHTML = "+";
    }
    else {
	ob.display = 'block';
	button.innerHTML = "-";
    }
    //ob.display = (ob.display == 'block')?'none': 'block';
}
</script>
</head><body>
<a name="top"></a>
<!-- wrap starts here -->
<div id="nottrac">
<div id="wrap">
	<a name="top"></a>
	<!-- header -->
	<div id="topheader">
		<div id="logo"><img src="logo.jpg" alt="pyVAFM" /></div>
		<!-- tabs 
		<ul>
			<li><a href="../index.html"><span>Home</span></a></li>
			<li><a href="./credits.html"><span>About</span></a></li>
			<li id="current"><a href="./index.html"><span>Documentation</span></a></li>
			<li><a href="../download.html"><span>Download</span></a></li>
			<li><a href="../contact.html"><span>Contact</span></a></li>
		</ul>
		-->
	</div>
	<div id="header-slogan">
	<span id="slogan">Pythonic Virtual Machine</span>
	</div>
	<div id="maincol">
    <div id="top"><!-- do not remove this div! -->
<!-- Generated by Doxygen 1.8.9.1 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">3d FM-AFM tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Running a full FM-AFM simulation of NaCl </h1>
<p>Now for a full simulation using most of the things you have learned in the past few tutorials so the explanation will be more brief. Definitely do not use this tutorial as a starting point, it is recommended that you have went through the previous tutorials first.</p>
<p>As always lets add our mandatory modules, including the phase lock loop (PLL) composite circuit that is required in AFM setups;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> vafmcircuits <span class="keyword">import</span> Machine</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> customs <span class="keyword">import</span> *</div>
</div><!-- fragment --><p>Lets initialise our machine;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine = Machine(machine=<span class="keywordtype">None</span>, name=<span class="stringliteral">&#39;machine&#39;</span>, dt=5.0e-8)</div>
</div><!-- fragment --><p>Lets add our <a class="el" href="classvafmcircuits__Cantilever_1_1Cantilever.html">Cantilever </a> circuit, the parameters are described in the documentation but for now lets use these values;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;canti = machine.AddCircuit(type=<span class="stringliteral">&#39;Cantilever&#39;</span>,name=<span class="stringliteral">&#39;canti&#39;</span>, startingz=0.5,Q=10000, k=167.0, f0=150000, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>Since we need to be able to measure amplitude we should include the amplitude detector composite circuit;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&quot;Machine&quot;</span>,name=<span class="stringliteral">&#39;amp&#39;</span>, fcut=10000, assembly=aAMPD, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>We need to know just how much we must excite the cantilever so we can do this using a PI circuit;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;PI&#39;</span>, name=<span class="stringliteral">&#39;agc&#39;</span>, Kp=1.1, Ki=800, set=1, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>It often safe practice to limit the agc signal so it doesn't get to high or negative so to do this we will implement a limiter circuit.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&quot;limiter&quot;</span>,name=<span class="stringliteral">&#39;agclim&#39;</span>, min=0,max=10, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>The most important part of an AFM set up is the PLL (Phase lock loop) as this is the device that actually gives us the change in frequency. Again we have a PLL composite circuit all set up already so simply follow the parameters given below;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&quot;Machine&quot;</span>,name=<span class="stringliteral">&#39;pll&#39;</span>, fcut=1000, assembly=aPLL, filters=[10000,5000,2000], gain=600.0, f0=150000, Kp=0.5, Ki=700, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>We need the excitation signal to be off phase by pi /2. Since the output of the pll will be out of phase by -pi /2 (a cosine output wave compared to a sine input wave), so we will invert the cos wave in order to give us a phase shift of pi /2).</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;opMul&#39;</span>,name=<span class="stringliteral">&#39;pllinv&#39;</span>,in2=-1, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>in order for us to excite the cantilever we must multiply the output of the PLL with the output of the PI circuit to ensure we get an appropriate excitation circuit, hence we must add a multiplication circuit;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;opMul&#39;</span>,name=<span class="stringliteral">&#39;exc&#39;</span>, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>We need to be able to move our cantilever so lets add the scanner circuit;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scanner = machine.AddCircuit(type=<span class="stringliteral">&#39;Scanner&#39;</span>,name=<span class="stringliteral">&#39;scan&#39;</span>, Process = machine, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>We have a 3d force field for the NaCl included in the tutorial, the details of how to add an interpolation circuit was covered in <a class="el" href="page_tutint.html">this </a> tutorial so I will simply state what is required here. One thing to note is the ForceMultiplier parameter this allows you to change the units of your force field to what ever it is you require;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;inter = machine.AddCircuit(type=<span class="stringliteral">&#39;i3Dlin&#39;</span>,name=<span class="stringliteral">&#39;inter&#39;</span>, components=3, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;inter.Configure(steps=[0.705,0.705,0.1], npoints=[8,8,201])</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;inter.Configure(pbc=[<span class="keyword">True</span>,<span class="keyword">True</span>,<span class="keyword">False</span>])</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;inter.Configure(ForceMultiplier=1e10)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;inter.ReadData(<span class="stringliteral">&#39;NaClforces.dat&#39;</span>)</div>
</div><!-- fragment --><p>We require an output circuit this is set up in the same way as as before, this time the channels we will register are "x" , "y" and the change in frequency "df".</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;imager = machine.AddCircuit(type=<span class="stringliteral">&#39;output&#39;</span>,name=<span class="stringliteral">&#39;image&#39;</span>,file=<span class="stringliteral">&#39;test.dat&#39;</span>, dump=0)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;imager.Register(<span class="stringliteral">&quot;scan.x&quot;</span>,<span class="stringliteral">&quot;scan.y&quot;</span>,<span class="stringliteral">&quot;pll.df&quot;</span>)</div>
</div><!-- fragment --><p>So we have added all the circuits we need for this FM-AFM setup so lets connect our circuits now. so lets hook up or x and y channel of the scanner to the x and y channel of the interpolation circuit;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&quot;scan.x&quot;</span> , <span class="stringliteral">&quot;inter.x&quot;</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;machine.Connect(<span class="stringliteral">&quot;scan.y&quot;</span> , <span class="stringliteral">&quot;inter.y&quot;</span>)</div>
</div><!-- fragment --><p>The z channel is a little more involved since the cantilever oscillates in that dimension we must connect the absolute position (position of the holder + oscillation of the cantilever) of the cantilever, so firstly lets connect the scanners z channel to the holder position of the cantilever;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&quot;scan.z&quot;</span> , <span class="stringliteral">&quot;canti.holderz&quot;</span>)</div>
</div><!-- fragment --><p>Next lets connect the absolute position of the cantilever (zabs) to the interpolation circuit, hence giving us the force where the tip is;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&quot;canti.zabs&quot;</span> , <span class="stringliteral">&quot;inter.z&quot;</span>)</div>
</div><!-- fragment --><p>now lets connect the third force component of the force field (the z component) to the force channel of the cantilever;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&quot;inter.F3&quot;</span> , <span class="stringliteral">&quot;canti.fz&quot;</span>)</div>
</div><!-- fragment --><p>So we need to measure the amplitude of the tip so lets connect the tip position to our amplitude detector;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&#39;canti.ztip&#39;</span>,<span class="stringliteral">&#39;amp.signal&#39;</span>)</div>
</div><!-- fragment --><p>So the amplitude detector is capable of outputting the amplitude of the wave or a normalised version of that wave. Since we need to know but how much to excite the wave by lets connect the amplitude to the PI circuit so we can measure that;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&#39;amp.amp&#39;</span>,<span class="stringliteral">&#39;agc.signal&#39;</span>)</div>
</div><!-- fragment --><p>So now we have to hook up our pll circuit, the pll must have a feedback by using the cos output of the pll and have the normalised cantilever as an input</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&#39;amp.norm&#39;</span>,<span class="stringliteral">&#39;pll.signal1&#39;</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;machine.Connect(<span class="stringliteral">&#39;pll.cos&quot;,&quot;pll.signal2&#39;</span>)</div>
</div><!-- fragment --><p>So now we can multiply the output from the PI circuit and the cos output of the pll circuit in order to create an excitation circuit and then connect this signal to the cantilever excitation channel;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&#39;agc.out&#39;</span>,<span class="stringliteral">&#39;agclim.signal&#39;</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;machine.Connect(<span class="stringliteral">&#39;agclim.out&#39;</span>,<span class="stringliteral">&#39;exc.in1&#39;</span>)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;machine.Connect(<span class="stringliteral">&#39;pll.cos&#39;</span>,<span class="stringliteral">&#39;pllinv.in1&#39;</span>)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;machine.Connect(<span class="stringliteral">&#39;pllinv.out&#39;</span>,<span class="stringliteral">&#39;exc.in2&#39;</span>)</div>
</div><!-- fragment --><p>Lets also connect the scanner record channel to the output recording channel;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&quot;scan.record&quot;</span>,<span class="stringliteral">&quot;image.record&quot;</span>)   </div>
</div><!-- fragment --><p>Now we have connected all our circuits and all that is left is to issue commands to the scanner in order to move the cantilever; Lets start by placing our cantilever at position 0,0,15 , please note that the distances are in angstroms since the force field is given in angstroms, also lets wait for 0.5 seconds;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scanner.Place(x=0,y=0,z=15)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;machine.Wait(0.5)   </div>
</div><!-- fragment --><p>Next lets move scanner down by 11 angstroms and have it wait for 1 seconds this will allow the pll to settle down before we start scanning;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scanner.Move(x=0,y=0,z=-11) </div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;machine.Wait(1)</div>
</div><!-- fragment --><p>Lets now set up our ScanArea function like we did in <a class="el" href="page_tutint.html">this </a> tutorial, except this time we want 64 points per line and 64 lines over an image area of 11.68 by 11.68 angstroms. If you are using gnuplot leave the blanklines as True but if you choose to use another plotting program that doesn't use the blank lines feel free to set it to False, finally use the ScanArea() function to begin your scan.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scanner.Recorder = imager</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;scanner.BlankLines = <span class="keyword">True</span> </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;scanner.Resolution = [20,20]</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;scanner.ImageArea(11.28,11.28)        </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;scanner.ScanArea()</div>
</div><!-- fragment --><p>So the final input file should look like this;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">#!/usr/bin/env python</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> vafmcircuits <span class="keyword">import</span> Machine</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> customs_pll <span class="keyword">import</span> *</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;machine = Machine(machine=<span class="keywordtype">None</span>, name=<span class="stringliteral">&#39;machine&#39;</span>, dt=5.0e-8)</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;canti = machine.AddCircuit(type=<span class="stringliteral">&#39;Cantilever&#39;</span>,name=<span class="stringliteral">&#39;canti&#39;</span>, startingz=0.5,Q=10000, k=167.0, f0=150000, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&quot;Machine&quot;</span>,name=<span class="stringliteral">&#39;amp&#39;</span>, fcut=10000, assembly=aAMPD, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;PI&#39;</span>, name=<span class="stringliteral">&#39;agc&#39;</span>, Kp=1.1, Ki=800, set=1, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&quot;limiter&quot;</span>,name=<span class="stringliteral">&#39;agclim&#39;</span>, min=0,max=10, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&quot;Machine&quot;</span>,name=<span class="stringliteral">&#39;pll&#39;</span>, fcut=1000, assembly=aPLL, filters=[10000,5000,2000], gain=600.0, f0=150000, Kp=0.5, Ki=700, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;opMul&#39;</span>,name=<span class="stringliteral">&#39;pllinv&#39;</span>,in2=-1, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;opMul&#39;</span>,name=<span class="stringliteral">&#39;exc&#39;</span>, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;scanner = machine.AddCircuit(type=<span class="stringliteral">&#39;Scanner&#39;</span>,name=<span class="stringliteral">&#39;scan&#39;</span>, Process = machine, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;inter = machine.AddCircuit(type=<span class="stringliteral">&#39;i3Dlin&#39;</span>,name=<span class="stringliteral">&#39;inter&#39;</span>, components=3, pushed=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;inter.Configure(steps=[0.705,0.705,0.1], npoints=[8,8,201])</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;inter.Configure(pbc=[<span class="keyword">True</span>,<span class="keyword">True</span>,<span class="keyword">False</span>])</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;inter.Configure(ForceMultiplier=1e10)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;inter.ReadData(<span class="stringliteral">&#39;NaClforces.dat&#39;</span>)</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">#Outputs</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;out1 = machine.AddCircuit(type=<span class="stringliteral">&#39;output&#39;</span>,name=<span class="stringliteral">&#39;output&#39;</span>,file=<span class="stringliteral">&#39;testafm.out&#39;</span>, dump=2)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;out1.Register(<span class="stringliteral">&#39;global.time&#39;</span>, <span class="stringliteral">&#39;canti.zabs&#39;</span>,<span class="stringliteral">&#39;amp.norm&#39;</span>,<span class="stringliteral">&#39;pll.cos&#39;</span>,<span class="stringliteral">&#39;pll.sin&#39;</span>,<span class="stringliteral">&#39;exc.in2&#39;</span>)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;out1.Stop()</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;out2 = machine.AddCircuit(type=<span class="stringliteral">&#39;output&#39;</span>,name=<span class="stringliteral">&#39;output2&#39;</span>,file=<span class="stringliteral">&#39;testafm2.out&#39;</span>, dump=10000)</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;out2.Register(<span class="stringliteral">&#39;global.time&#39;</span>, <span class="stringliteral">&#39;canti.ztip&#39;</span>,<span class="stringliteral">&#39;agc.out&#39;</span>,<span class="stringliteral">&#39;pll.df&#39;</span>,<span class="stringliteral">&quot;canti.fz&quot;</span>)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;out2.Stop()</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">#Imaging output</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;imager = machine.AddCircuit(type=<span class="stringliteral">&#39;output&#39;</span>,name=<span class="stringliteral">&#39;image&#39;</span>,file=<span class="stringliteral">&#39;NaCl.dat&#39;</span>, dump=0)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;imager.Register(<span class="stringliteral">&quot;scan.x&quot;</span>,<span class="stringliteral">&quot;scan.y&quot;</span>,<span class="stringliteral">&quot;pll.df&quot;</span>) </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">#feed x and y to interpolation</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;machine.Connect(<span class="stringliteral">&quot;scan.x&quot;</span> , <span class="stringliteral">&quot;inter.x&quot;</span>)</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;machine.Connect(<span class="stringliteral">&quot;scan.y&quot;</span> , <span class="stringliteral">&quot;inter.y&quot;</span>)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;machine.Connect(<span class="stringliteral">&quot;scan.z&quot;</span> , <span class="stringliteral">&quot;canti.holderz&quot;</span>)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;machine.Connect(<span class="stringliteral">&quot;canti.zabs&quot;</span> , <span class="stringliteral">&quot;inter.z&quot;</span>)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">#Force</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;machine.Connect(<span class="stringliteral">&quot;inter.F3&quot;</span> , <span class="stringliteral">&quot;canti.fz&quot;</span>)    </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;machine.Connect(<span class="stringliteral">&#39;canti.ztip&#39;</span>,<span class="stringliteral">&#39;amp.signal&#39;</span>)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;machine.Connect(<span class="stringliteral">&#39;amp.amp&#39;</span>,<span class="stringliteral">&#39;agc.signal&#39;</span>)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;machine.Connect(<span class="stringliteral">&#39;amp.norm&#39;</span>,<span class="stringliteral">&#39;pll.signal1&#39;</span>)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;machine.Connect(<span class="stringliteral">&#39;pll.cos&#39;</span>,<span class="stringliteral">&#39;pll.signal2&#39;</span>)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;machine.Connect(<span class="stringliteral">&#39;agc.out&#39;</span>,<span class="stringliteral">&#39;agclim.signal&#39;</span>)</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;machine.Connect(<span class="stringliteral">&#39;agclim.out&#39;</span>,<span class="stringliteral">&#39;exc.in1&#39;</span>)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;machine.Connect(<span class="stringliteral">&#39;pll.cos&#39;</span>,<span class="stringliteral">&#39;pllinv.in1&#39;</span>)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;machine.Connect(<span class="stringliteral">&#39;pllinv.out&#39;</span>,<span class="stringliteral">&#39;exc.in2&#39;</span>)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;machine.Connect(<span class="stringliteral">&#39;exc.out&#39;</span>,<span class="stringliteral">&#39;canti.exciter&#39;</span>)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;machine.Connect(<span class="stringliteral">&quot;scan.record&quot;</span>,<span class="stringliteral">&quot;image.record&quot;</span>)   </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;scanner.Place(x=0,y=0,z=15)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;machine.Wait(0.5)   </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;scanner.Move(x=0,y=0,z=-11)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;machine.Wait(1) </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;scanner.Recorder = imager</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;scanner.BlankLines = <span class="keyword">True</span> </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">#resolution of the image [# points per line, # lines]</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;scanner.Resolution = [20,20]</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;scanner.ImageArea(11.28,11.28)        </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">#scan</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;scanner.ScanArea()</div>
</div><!-- fragment --><p>This scan will most likely take a long time you can reduce the time it will take by altering the resolution parameter. After it has finished running plot an intensity plot, if you are using gnuplot you can use the following commands;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;set pm3d</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;set size square</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;set palette rgbformula 34,35,36</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;sp <span class="stringliteral">&quot;NaCl.dat&quot;</span> using 1:2:3</div>
</div><!-- fragment --><p>Your results should look similar to the image below;</p>
<p> 
<img src="tut5.png" width="800px">
 </p>
</div></div><!-- contents -->

<hr size="1"><address style="text-align: right;">
<div class="float-left">Documentation for pyVAFM </div>
<div class="float-right">
<small>
Generated on Fri Dec 18 2015 12:38:59 for pyVAFM by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.9.1</small></address>
</div>
<!-- top ends here -->
<!-- </div> -->
<!-- wrap ends here -->
</div>
<!-- footer starts here -->
<div class="footer">
    <p>
    <a href="./index.html">Home</a><br>
    Copyright &copy; 2013 Regents of Aalto University
    </p>
</div>
</div>
</body>
</html>

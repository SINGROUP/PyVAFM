<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Compisite Circuit tutorial</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<!--<link href="tabs.css" rel="stylesheet" type="text/css"> -->
<!-- <script src="../mathjax/MathJax.js">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script> -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22953817-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script type="text/javascript">
function toggleMenu(objID, button) {
    if (!document.getElementById) return;
    var ob = document.getElementById(objID).style;
    if(ob.display == 'block') {
	ob.display = 'none';
	button.innerHTML = "+";
    }
    else {
	ob.display = 'block';
	button.innerHTML = "-";
    }
    //ob.display = (ob.display == 'block')?'none': 'block';
}
</script>
</head><body>
<a name="top"></a>
<!-- wrap starts here -->
<div id="nottrac">
<div id="wrap">
	<a name="top"></a>
	<!-- header -->
	<div id="topheader">
		<div id="logo"><img src="logo.jpg" alt="pyVAFM" /></div>
		<!-- tabs 
		<ul>
			<li><a href="../index.html"><span>Home</span></a></li>
			<li><a href="./credits.html"><span>About</span></a></li>
			<li id="current"><a href="./index.html"><span>Documentation</span></a></li>
			<li><a href="../download.html"><span>Download</span></a></li>
			<li><a href="../contact.html"><span>Contact</span></a></li>
		</ul>
		-->
	</div>
	<div id="header-slogan">
	<span id="slogan">Pythonic Virtual Machine</span>
	</div>
	<div id="maincol">
    <div id="top"><!-- do not remove this div! -->
<!-- Generated by Doxygen 1.8.9.1 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Compisite Circuit tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Building a composite circuit </h1>
<p>Lets first start by creating the composite circuit so we as per usual start the mandatory imports;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> vafmbase <span class="keyword">import</span> ChannelType</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> vafmcircuits <span class="keyword">import</span> Machine</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> vafmcircuits</div>
</div><!-- fragment --><p>So to start building the compisite circuit we first must create a function with the following arguments, the name of the function will be the name of your compisite circuit so you can make that what you desire, but for now lets call it ADC.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">def </span>ADC(compo,**keys):</div>
</div><!-- fragment --><p>A composite circuit has input and output channels similar to regular circuits, so we must define these. You can name them whatever you want but each one must be unique, below we have added two input channels named "signal1" and "signal2" and one output channel named "out";</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;compo.AddInput(<span class="stringliteral">&quot;signal1&quot;</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;compo.AddInput(<span class="stringliteral">&quot;signal2&quot;</span>)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;compo.AddOutput(<span class="stringliteral">&quot;out&quot;</span>)</div>
</div><!-- fragment --><p>Now we have created the signal channels next is to add the addition circuit that we require.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;compo.AddCircuit(type=<span class="stringliteral">&#39;opAdd&#39;</span>,name=<span class="stringliteral">&#39;adder&#39;</span>,factors=2, pushed=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>Just like in a regular input file we still must connect the channels but this time we have channels that are associated with the composite circuit so in order to access these channels we must use the global affix followed by .channel name;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;compo.Connect(<span class="stringliteral">&quot;global.signal1&quot;</span>,<span class="stringliteral">&quot;adder.in1&quot;</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;compo.Connect(<span class="stringliteral">&quot;global.signal2&quot;</span>,<span class="stringliteral">&quot;adder.in2&quot;</span>)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;compo.Connect(<span class="stringliteral">&quot;adder.out&quot;</span>,<span class="stringliteral">&quot;global.out&quot;</span>)</div>
</div><!-- fragment --><p>Finally its a nice idea to add a print statement to let you know when the circuit has been added;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keywordflow">print</span> <span class="stringliteral">&quot;ADC assembled!&quot;</span></div>
</div><!-- fragment --><p>So the final compisite file should look like this (notice the indentation if you aren't familiar with python) ;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> vafmbase <span class="keyword">import</span> ChannelType</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> vafmcircuits <span class="keyword">import</span> Machine</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> vafmcircuits</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">def </span>ADC(compo,**keys):</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    compo.AddInput(<span class="stringliteral">&quot;signal1&quot;</span>)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    compo.AddInput(<span class="stringliteral">&quot;signal2&quot;</span>)</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    compo.AddOutput(<span class="stringliteral">&quot;out&quot;</span>)</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    compo.AddCircuit(type=<span class="stringliteral">&#39;opAdd&#39;</span>,name=<span class="stringliteral">&#39;adder&#39;</span>)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    compo.Connect(<span class="stringliteral">&quot;global.signal1&quot;</span>,<span class="stringliteral">&quot;adder.in1&quot;</span>)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    compo.Connect(<span class="stringliteral">&quot;global.signal2&quot;</span>,<span class="stringliteral">&quot;adder.in2&quot;</span>)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    compo.Connect(<span class="stringliteral">&quot;adder.out&quot;</span>,<span class="stringliteral">&quot;global.out&quot;</span>)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="keywordflow">print</span> <span class="stringliteral">&quot;ADC assembled!&quot;</span></div>
</div><!-- fragment --><p>Now the main input file will be created, first as always we include the modules but this time we must also include the composite circuit;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> vafmbase <span class="keyword">import</span> ChannelType</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> vafmcircuits <span class="keyword">import</span> Machine</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> tut3comp <span class="keyword">import</span> *</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> vafmcircuits</div>
</div><!-- fragment --><p>Lets now initialise our machine and add a waver circuit just like we did in tutorial 6.1</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine = Machine(name=<span class="stringliteral">&#39;machine&#39;</span>, dt=0.01);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;osc = machine.AddCircuit(type=<span class="stringliteral">&#39;waver&#39;</span>,name=<span class="stringliteral">&#39;osc&#39;</span>, amp=1, freq=1)</div>
</div><!-- fragment --><p>Now we must add our composite circuit, its done in more or less the same way as regular circuit except we must use the assembly parameter, this parameter must be made equal to the function name of that composite circuit so for example in this case its ADC. This parameter is not a string so do not use inverted commas as shown below;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;Machine&#39;</span>, name=<span class="stringliteral">&#39;compo1&#39;</span>, assembly=ADC)</div>
</div><!-- fragment --><p>Now lets add our output circuit and register the channels we need;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;out1 = machine.AddCircuit(type=<span class="stringliteral">&#39;output&#39;</span>,name=<span class="stringliteral">&#39;output&#39;</span>,file=<span class="stringliteral">&#39;tut3.dat&#39;</span>, dump=1)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;out1.Register(<span class="stringliteral">&#39;global.time&#39;</span>, <span class="stringliteral">&#39;osc.sin&#39;</span>, <span class="stringliteral">&#39;osc.cos&#39;</span>, <span class="stringliteral">&#39;compo1.out&#39;</span>)</div>
</div><!-- fragment --><p>Notice that the circuit compo1 is using the output channel name that you set earlier in the other file.</p>
<p>Next we must connect the channels as we have done in previous input files and again we will use the composite circuits input channels that we defined earlier;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&quot;osc.sin&quot;</span>,<span class="stringliteral">&quot;compo1.signal1&quot;</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;machine.Connect(<span class="stringliteral">&quot;osc.sin&quot;</span>,<span class="stringliteral">&quot;compo1.signal2&quot;</span>)</div>
</div><!-- fragment --><p>Finally lets ask the machine to wait for 5 seconds;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Wait(5)</div>
</div><!-- fragment --><p>So our final input file should look like this;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> vafmbase <span class="keyword">import</span> ChannelType</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> vafmcircuits <span class="keyword">import</span> Machine</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> tut3comp <span class="keyword">import</span> *</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> vafmcircuits</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;machine = Machine(name=<span class="stringliteral">&#39;machine&#39;</span>, dt=0.01);</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;waver&#39;</span>,name=<span class="stringliteral">&#39;osc&#39;</span>, amp=1, freq=1)</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;machine.AddCircuit(type=<span class="stringliteral">&#39;Machine&#39;</span>, name=<span class="stringliteral">&#39;compo1&#39;</span>, assembly=ADC)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;out1 = machine.AddCircuit(type=<span class="stringliteral">&#39;output&#39;</span>,name=<span class="stringliteral">&#39;output&#39;</span>,file=<span class="stringliteral">&#39;tut3.dat&#39;</span>, dump=1)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;out1.Register(<span class="stringliteral">&#39;global.time&#39;</span>, <span class="stringliteral">&#39;osc.sin&#39;</span>, <span class="stringliteral">&#39;osc.cos&#39;</span>, <span class="stringliteral">&#39;compo1.out&#39;</span>)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;machine.Connect(<span class="stringliteral">&quot;osc.sin&quot;</span>,<span class="stringliteral">&quot;compo1.signal1&quot;</span>)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;machine.Connect(<span class="stringliteral">&quot;osc.sin&quot;</span>,<span class="stringliteral">&quot;compo1.signal2&quot;</span>)</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;machine.Wait(5)</div>
</div><!-- fragment --><p>When you run and plot the output you should get something looking like figure 4 which resembles what we got in tutorial 1.</p>
<p> 
<img src="tut3.png" width="800px">
 </p>
</div></div><!-- contents -->

<hr size="1"><address style="text-align: right;">
<div class="float-left">Documentation for pyVAFM </div>
<div class="float-right">
<small>
Generated on Tue Nov 1 2016 15:41:03 for pyVAFM by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.9.1</small></address>
</div>
<!-- top ends here -->
<!-- </div> -->
<!-- wrap ends here -->
</div>
<!-- footer starts here -->
<div class="footer">
    <p>
    <a href="./index.html">Home</a><br>
    Copyright &copy; 2013 Regents of Aalto University
    </p>
</div>
</div>
</body>
</html>

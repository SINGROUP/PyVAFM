<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Interpolation and scanner circuit tutorial</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<!--<link href="tabs.css" rel="stylesheet" type="text/css"> -->
<!-- <script src="../mathjax/MathJax.js">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script> -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22953817-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script type="text/javascript">
function toggleMenu(objID, button) {
    if (!document.getElementById) return;
    var ob = document.getElementById(objID).style;
    if(ob.display == 'block') {
	ob.display = 'none';
	button.innerHTML = "+";
    }
    else {
	ob.display = 'block';
	button.innerHTML = "-";
    }
    //ob.display = (ob.display == 'block')?'none': 'block';
}
</script>
</head><body>
<a name="top"></a>
<!-- wrap starts here -->
<div id="nottrac">
<div id="wrap">
	<a name="top"></a>
	<!-- header -->
	<div id="topheader">
		<div id="logo"><img src="logo.jpg" alt="pyVAFM" /></div>
		<!-- tabs 
		<ul>
			<li><a href="../index.html"><span>Home</span></a></li>
			<li><a href="./credits.html"><span>About</span></a></li>
			<li id="current"><a href="./index.html"><span>Documentation</span></a></li>
			<li><a href="../download.html"><span>Download</span></a></li>
			<li><a href="../contact.html"><span>Contact</span></a></li>
		</ul>
		-->
	</div>
	<div id="header-slogan">
	<span id="slogan">Pythonic Virtual Machine</span>
	</div>
	<div id="maincol">
    <div id="top"><!-- do not remove this div! -->
<!-- Generated by Doxygen 1.8.9.1 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Interpolation and scanner circuit tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Interpolation and Scanner circuit </h1>
<p>In this tutorial you will learn how to use both the interpolation and scanning circuits, we will be interpolating the force field file named "NaClforces.dat" located in the tutorial folder.</p>
<p>So lets start as we did before with our mandatory imports and define our machine;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> vafmbase <span class="keyword">import</span> ChannelType</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> vafmcircuits <span class="keyword">import</span> Machine</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> vafmcircuits</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;machine = Machine(machine=<span class="keywordtype">None</span>, name=<span class="stringliteral">&#39;machine&#39;</span>, dt=0.01)</div>
</div><!-- fragment --><p>So now we must add both the <a class="el" href="classvafmcircuits__Interpolation_1_1i3Dlin.html">Interpolation</a> and the <a class="el" href="classvafmcircuits__Scanner_1_1Scanner.html">Scanner </a> circuit in the usual manner;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scan = machine.AddCircuit(type=<span class="stringliteral">&#39;Scanner&#39;</span>,name=<span class="stringliteral">&#39;scann&#39;</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;inter = machine.AddCircuit(type=<span class="stringliteral">&#39;i3Dlin&#39;</span>,name=<span class="stringliteral">&#39;inter&#39;</span>, components=3)</div>
</div><!-- fragment --><p>The only thing here worth noting is the "components" parameter, this is how many components we have in the force field, so in this case (as we will see later on) we have 3 (fx,fy and fz).</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;inter.Configure(steps=[0.705,0.705,0.1], npoints=[8,8,201])</div>
</div><!-- fragment --><p>Lets start configuring the interpolation circuit, first we must set the step size with the steps parameter. The force field is in the format of :</p>
<blockquote class="doxtable">
<p>1 1 1 fx fy fz <br />
 1 1 2 fx fy fz <br />
 .. .. .. .. .. <br />
 .. .. .. .. .. <br />
 x y z fx fy fz <br />
 </p>
</blockquote>
<p>Where x y and z are the index of that particular point in the force field, so in order to allow the scanner to moved in the correct units we must change these indexes to what ever the correct step size is. In this case the step in x and y is 0.705 and the step in z in 0.1. Next we must define the number of points in each dimension using the "npoints" parameter in this case we know that the x and y axis both contain 8 points each and the z direction contains 201 points.</p>
<p>At this point we are going to set the periodic boundary conditions using the "pbc" parameter;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;inter.Configure(pbc=[<span class="keyword">True</span>,<span class="keyword">True</span>,<span class="keyword">False</span>])</div>
</div><!-- fragment --><p>So here we have set the boundary conditions to be periodic in the x and y direction but not in the z. Next we have to tell the interpolation circuit what the force field is called;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;inter.ReadData(<span class="stringliteral">&#39;NaClforces.dat&#39;</span>)</div>
</div><!-- fragment --><p>So we have told the interpolation circuit that the file is called "NaClforces.dat" and this file must be in the format described previously and located in the same folder as the input file.</p>
<p>So now that we have configured the interpolation circuit we must now connect the x y and z output channels of the scanner to the x y and z input channels of the interpolation, as shown below;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&quot;scann.x&quot;</span> , <span class="stringliteral">&quot;inter.x&quot;</span>)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;machine.Connect(<span class="stringliteral">&quot;scann.y&quot;</span> , <span class="stringliteral">&quot;inter.y&quot;</span>)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;machine.Connect(<span class="stringliteral">&quot;scann.z&quot;</span> , <span class="stringliteral">&quot;inter.z&quot;</span>)</div>
</div><!-- fragment --><p>next we must set up our output circuit again this is done in the same way as before but take note we set "dump=0" because we plan to use the ScanArea feature of the PyVAFM and we are using the output channel F3 which corresponds to third component in the forcefield.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;imager = machine.AddCircuit(type=<span class="stringliteral">&#39;output&#39;</span>,name=<span class="stringliteral">&#39;image&#39;</span>,file=<span class="stringliteral">&#39;tut2.dat&#39;</span>, dump=0)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;imager.Register(<span class="stringliteral">&quot;scann.x&quot;</span>, <span class="stringliteral">&quot;scann.y&quot;</span>, <span class="stringliteral">&#39;inter.F3&#39;</span>)</div>
</div><!-- fragment --><p>Since we plan to use the ScanArea feature we must now connect the record output channel of the scanner to the record input channel of the output circuit;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;machine.Connect(<span class="stringliteral">&quot;scann.record&quot;</span>, <span class="stringliteral">&quot;image.record&quot;</span>)</div>
</div><!-- fragment --><p>Now that we have finally set up our machine we can now start issuing commands to it, we will only be using a hand full of the scanner commands although more can be found on the documentation webpage.</p>
<p>lets start by placing our scanner in the force field at position 0,0,4;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scan.Place(x=0, y=0, z=4)</div>
</div><!-- fragment --><p>In order to use the ScanArea function we must also tell the scanner what output circuit we plan to use with the Recorder command;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scan.Recorder = imager</div>
</div><!-- fragment --><p>If you plan to use gnuplot then we suggest you use this line so that it can plotted with ease using gnuplot;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scan.BlankLines = <span class="keyword">True</span> </div>
</div><!-- fragment --><p>All this does is print blank lines at the end of every row, more information can be found in the gnuplot documentation on how to plot 3d data.</p>
<p>Next we will set the resolution of our image as 64 points per line and 64 lines;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scan.Resolution = [64,64]</div>
</div><!-- fragment --><p>Now we will set the area that we will scan over;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scan.ImageArea(11.68,11.68) </div>
</div><!-- fragment --><p>Finally all that remains is to initialise the ScanArea function;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;scan.ScanArea()</div>
</div><!-- fragment --><p>The final input script should look like this;</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> vafmbase <span class="keyword">import</span> ChannelType</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> vafmcircuits <span class="keyword">import</span> Machine</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> vafmcircuits</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;machine = Machine(machine=<span class="keywordtype">None</span>, name=<span class="stringliteral">&#39;machine&#39;</span>, dt=0.01)</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;scan = machine.AddCircuit(type=<span class="stringliteral">&#39;Scanner&#39;</span>,name=<span class="stringliteral">&#39;scann&#39;</span>)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;inter = machine.AddCircuit(type=<span class="stringliteral">&#39;i3Dlin&#39;</span>,name=<span class="stringliteral">&#39;inter&#39;</span>, components=3)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;inter.Configure(steps=[0.705,0.705,0.1], npoints=[8,8,201])</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;inter.Configure(pbc=[<span class="keyword">True</span>,<span class="keyword">True</span>,<span class="keyword">False</span>])</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;inter.ReadData(<span class="stringliteral">&#39;NaClforces.dat&#39;</span>)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;machine.Connect(<span class="stringliteral">&quot;scann.x&quot;</span> , <span class="stringliteral">&quot;inter.x&quot;</span>)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;machine.Connect(<span class="stringliteral">&quot;scann.y&quot;</span> , <span class="stringliteral">&quot;inter.y&quot;</span>)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;machine.Connect(<span class="stringliteral">&quot;scann.z&quot;</span> , <span class="stringliteral">&quot;inter.z&quot;</span>)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">#image output</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;imager = machine.AddCircuit(type=<span class="stringliteral">&#39;output&#39;</span>,name=<span class="stringliteral">&#39;image&#39;</span>,file=<span class="stringliteral">&#39;tut2.dat&#39;</span>, dump=0)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;imager.Register(<span class="stringliteral">&quot;scann.x&quot;</span>, <span class="stringliteral">&quot;scann.y&quot;</span>, <span class="stringliteral">&#39;inter.F3&#39;</span>)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;machine.Connect(<span class="stringliteral">&quot;scann.record&quot;</span>, <span class="stringliteral">&quot;image.record&quot;</span>)</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;scan.Place(x=0 y=0, z=4)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">#this will print an empty line after each scanline</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;scan.Recorder = imager</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;scan.BlankLines = <span class="keyword">True</span> </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">#not necessary, but it makes it easier for gnuplot</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">#resolution of the image [# points per line, # lines]</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;scan.Resolution = [64,64]</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;scan.ImageArea(11.68,11.68) </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">#scan</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;scan.ScanArea()</div>
</div><!-- fragment --><p>So assuming you are using gnuplot use the following commands in order to plot the image</p>
<pre class="fragment">set pm3d
set size square
set palette rgbformula 34,35,36
sp "tut2.dat" using 1:2:3
</pre><p>You should get something that looks like this;</p>
<p> 
<img src="tut2.png" width="800px">
 </p>
</div></div><!-- contents -->

<hr size="1"><address style="text-align: right;">
<div class="float-left">Documentation for pyVAFM </div>
<div class="float-right">
<small>
Generated on Fri Dec 18 2015 12:53:44 for pyVAFM by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.9.1</small></address>
</div>
<!-- top ends here -->
<!-- </div> -->
<!-- wrap ends here -->
</div>
<!-- footer starts here -->
<div class="footer">
    <p>
    <a href="./index.html">Home</a><br>
    Copyright &copy; 2013 Regents of Aalto University
    </p>
</div>
</div>
</body>
</html>
